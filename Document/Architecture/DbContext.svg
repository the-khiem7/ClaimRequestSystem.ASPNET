<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1199px" preserveAspectRatio="none" style="width:876px;height:1199px;background:#FFFFFF;" version="1.1" viewBox="0 0 876 1199" width="876px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="212.6016" style="stroke:#181818;stroke-width:1.0;" width="10" x="309.5" y="98.4297"/><rect fill="#FFFFFF" height="520.0625" style="stroke:#181818;stroke-width:1.0;" width="10" x="309.5" y="591.2266"/><rect fill="#FFFFFF" height="916.6563" style="stroke:#181818;stroke-width:1.0;" width="10" x="494.5" y="195.6328"/><rect fill="#FFFFFF" height="229.9297" style="stroke:#181818;stroke-width:1.0;" width="10" x="499.5" y="332.1641"/><rect fill="#FFFFFF" height="408.5313" style="stroke:#181818;stroke-width:1.0;" width="10" x="499.5" y="702.7578"/><rect fill="#FFFFFF" height="171.6641" style="stroke:#181818;stroke-width:1.0;" width="10" x="659.5" y="361.2969"/><rect fill="#FFFFFF" height="490.9297" style="stroke:#181818;stroke-width:1.0;" width="10" x="659.5" y="620.3594"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="818.5" y="432.5625"/><rect fill="#FFFFFF" height="116.5313" style="stroke:#181818;stroke-width:1.0;" width="10" x="818.5" y="673.625"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="818.5" y="877.5547"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="818.5" y="1008.8906"/><rect fill="none" height="190.6016" style="stroke:#000000;stroke-width:1.5;" width="570.5" x="10" y="113.4297"/><rect fill="none" height="468.9297" style="stroke:#000000;stroke-width:1.5;" width="859.5" x="10" y="635.3594"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="46" x2="46" y1="67.2969" y2="1121.2891"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="314" x2="314" y1="67.2969" y2="1121.2891"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="499.5" x2="499.5" y1="67.2969" y2="1121.2891"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="664.5" x2="664.5" y1="67.2969" y2="1121.2891"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="823.5" x2="823.5" y1="67.2969" y2="1121.2891"/><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="53" x="20" y="36"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="27" y="55.9951">Client</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="53" x="20" y="1120.2891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="27" y="1140.2842">Client</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="91" x="269" y="36"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77" x="276" y="55.9951">UnitOfWork</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="91" x="269" y="1120.2891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77" x="276" y="1140.2842">UnitOfWork</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="142" x="428.5" y="36"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="128" x="435.5" y="55.9951">GenericRepository</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="142" x="428.5" y="1120.2891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="128" x="435.5" y="1140.2842">GenericRepository</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="620.5" y="36"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74" x="627.5" y="55.9951">DbContext</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="620.5" y="1120.2891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74" x="627.5" y="1140.2842">DbContext</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="787.5" y="63.9951">Database</text><path d="M805.5,15 C805.5,5 823.5,5 823.5,5 C823.5,5 841.5,5 841.5,15 L841.5,41 C841.5,51 823.5,51 823.5,51 C823.5,51 805.5,51 805.5,41 L805.5,15 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M805.5,15 C805.5,25 823.5,25 823.5,25 C823.5,25 841.5,25 841.5,15 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="787.5" y="1133.2842">Database</text><path d="M805.5,1146.5859 C805.5,1136.5859 823.5,1136.5859 823.5,1136.5859 C823.5,1136.5859 841.5,1136.5859 841.5,1146.5859 L841.5,1172.5859 C841.5,1182.5859 823.5,1182.5859 823.5,1182.5859 C823.5,1182.5859 805.5,1182.5859 805.5,1172.5859 L805.5,1146.5859 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M805.5,1146.5859 C805.5,1156.5859 823.5,1156.5859 823.5,1156.5859 C823.5,1156.5859 841.5,1156.5859 841.5,1146.5859 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><rect fill="#FFFFFF" height="212.6016" style="stroke:#181818;stroke-width:1.0;" width="10" x="309.5" y="98.4297"/><rect fill="#FFFFFF" height="520.0625" style="stroke:#181818;stroke-width:1.0;" width="10" x="309.5" y="591.2266"/><rect fill="#FFFFFF" height="916.6563" style="stroke:#181818;stroke-width:1.0;" width="10" x="494.5" y="195.6328"/><rect fill="#FFFFFF" height="229.9297" style="stroke:#181818;stroke-width:1.0;" width="10" x="499.5" y="332.1641"/><rect fill="#FFFFFF" height="408.5313" style="stroke:#181818;stroke-width:1.0;" width="10" x="499.5" y="702.7578"/><rect fill="#FFFFFF" height="171.6641" style="stroke:#181818;stroke-width:1.0;" width="10" x="659.5" y="361.2969"/><rect fill="#FFFFFF" height="490.9297" style="stroke:#181818;stroke-width:1.0;" width="10" x="659.5" y="620.3594"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="818.5" y="432.5625"/><rect fill="#FFFFFF" height="116.5313" style="stroke:#181818;stroke-width:1.0;" width="10" x="818.5" y="673.625"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="818.5" y="877.5547"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="818.5" y="1008.8906"/><polygon fill="#181818" points="297.5,94.4297,307.5,98.4297,297.5,102.4297,301.5,98.4297" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="46.5" x2="303.5" y1="98.4297" y2="98.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="53.5" y="93.3638">GetRepository&lt;TEntity&gt;()</text><path d="M10,113.4297 L74,113.4297 L74,120.5625 L64,130.5625 L10,130.5625 L10,113.4297 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="190.6016" style="stroke:#000000;stroke-width:1.5;" width="570.5" x="10" y="113.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="25" y="126.4966">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="178" x="89" y="125.6401">[Repository exists in cache]</text><polygon fill="#181818" points="57.5,147.6953,47.5,151.6953,57.5,155.6953,53.5,151.6953" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="51.5" x2="308.5" y1="151.6953" y2="151.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="63.5" y="146.6294">Cached Repository</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="580.5" y1="160.6953" y2="160.6953"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="153" x="15" y="170.9058">[Create new repository]</text><polygon fill="#181818" points="482.5,191.6328,492.5,195.6328,482.5,199.6328,486.5,195.6328" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="319.5" x2="488.5" y1="195.6328" y2="195.6328"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="326.5" y="190.5669">&lt;&lt;create&gt;&gt;</text><polygon fill="#181818" points="330.5,220.7656,320.5,224.7656,330.5,228.7656,326.5,224.7656" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="324.5" x2="493.5" y1="224.7656" y2="224.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151" x="336.5" y="219.6997">new repository instance</text><line style="stroke:#181818;stroke-width:1.0;" x1="319.5" x2="361.5" y1="253.8984" y2="253.8984"/><line style="stroke:#181818;stroke-width:1.0;" x1="361.5" x2="361.5" y1="253.8984" y2="266.8984"/><line style="stroke:#181818;stroke-width:1.0;" x1="320.5" x2="361.5" y1="266.8984" y2="266.8984"/><polygon fill="#181818" points="330.5,262.8984,320.5,266.8984,330.5,270.8984,326.5,266.8984" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108" x="326.5" y="248.8325">Cache repository</text><polygon fill="#181818" points="57.5,292.0313,47.5,296.0313,57.5,300.0313,53.5,296.0313" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="51.5" x2="308.5" y1="296.0313" y2="296.0313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="63.5" y="290.9653">New Repository</text><polygon fill="#181818" points="487.5,328.1641,497.5,332.1641,487.5,336.1641,491.5,332.1641" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="46.5" x2="493.5" y1="332.1641" y2="332.1641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208" x="53.5" y="327.0981">SingleOrDefaultAsync(predicate)</text><polygon fill="#181818" points="647.5,357.2969,657.5,361.2969,647.5,365.2969,651.5,361.2969" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="509.5" x2="653.5" y1="361.2969" y2="361.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97" x="516.5" y="356.231">Set&lt;TEntity&gt;()</text><line style="stroke:#181818;stroke-width:1.0;" x1="669.5" x2="711.5" y1="390.4297" y2="390.4297"/><line style="stroke:#181818;stroke-width:1.0;" x1="711.5" x2="711.5" y1="390.4297" y2="403.4297"/><line style="stroke:#181818;stroke-width:1.0;" x1="670.5" x2="711.5" y1="403.4297" y2="403.4297"/><polygon fill="#181818" points="680.5,399.4297,670.5,403.4297,680.5,407.4297,676.5,403.4297" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="676.5" y="385.3638">CreateQuery</text><polygon fill="#181818" points="806.5,428.5625,816.5,432.5625,806.5,436.5625,810.5,432.5625" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="669.5" x2="812.5" y1="432.5625" y2="432.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93" x="676.5" y="427.4966">Execute Query</text><polygon fill="#181818" points="680.5,457.6953,670.5,461.6953,680.5,465.6953,676.5,461.6953" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="674.5" x2="822.5" y1="461.6953" y2="461.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="60" x="686.5" y="456.6294">Raw Data</text><line style="stroke:#181818;stroke-width:1.0;" x1="669.5" x2="711.5" y1="490.8281" y2="490.8281"/><line style="stroke:#181818;stroke-width:1.0;" x1="711.5" x2="711.5" y1="490.8281" y2="503.8281"/><line style="stroke:#181818;stroke-width:1.0;" x1="670.5" x2="711.5" y1="503.8281" y2="503.8281"/><polygon fill="#181818" points="680.5,499.8281,670.5,503.8281,680.5,507.8281,676.5,503.8281" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="676.5" y="485.7622">Map to Entity</text><polygon fill="#181818" points="520.5,528.9609,510.5,532.9609,520.5,536.9609,516.5,532.9609" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="514.5" x2="663.5" y1="532.9609" y2="532.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="36" x="526.5" y="527.895">Entity</text><polygon fill="#181818" points="57.5,558.0938,47.5,562.0938,57.5,566.0938,53.5,562.0938" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="51.5" x2="493.5" y1="562.0938" y2="562.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="36" x="63.5" y="557.0278">Entity</text><polygon fill="#181818" points="297.5,587.2266,307.5,591.2266,297.5,595.2266,301.5,591.2266" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="46.5" x2="303.5" y1="591.2266" y2="591.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="244" x="53.5" y="586.1606">ProcessInTransactionAsync(operation)</text><polygon fill="#181818" points="647.5,616.3594,657.5,620.3594,647.5,624.3594,651.5,620.3594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="319.5" x2="653.5" y1="620.3594" y2="620.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="326.5" y="615.2935">BeginTransactionAsync()</text><path d="M10,635.3594 L74,635.3594 L74,642.4922 L64,652.4922 L10,652.4922 L10,635.3594 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="468.9297" style="stroke:#000000;stroke-width:1.5;" width="859.5" x="10" y="635.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="25" y="648.4263">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="138" x="89" y="647.5698">[Operation succeeds]</text><polygon fill="#181818" points="806.5,669.625,816.5,673.625,806.5,677.625,810.5,673.625" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="669.5" x2="812.5" y1="673.625" y2="673.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="676.5" y="668.5591">Begin Transaction</text><polygon fill="#181818" points="487.5,698.7578,497.5,702.7578,487.5,706.7578,491.5,702.7578" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="46.5" x2="493.5" y1="702.7578" y2="702.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131" x="53.5" y="697.6919">UpdateAsync(entity)</text><polygon fill="#181818" points="647.5,727.8906,657.5,731.8906,647.5,735.8906,651.5,731.8906" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="509.5" x2="653.5" y1="731.8906" y2="731.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="516.5" y="726.8247">Update Entity State</text><polygon fill="#181818" points="806.5,757.0234,816.5,761.0234,806.5,765.0234,810.5,761.0234" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="669.5" x2="812.5" y1="761.0234" y2="761.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="676.5" y="755.9575">Execute Update</text><polygon fill="#181818" points="680.5,786.1563,670.5,790.1563,680.5,794.1563,676.5,790.1563" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="674.5" x2="822.5" y1="790.1563" y2="790.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="686.5" y="785.0903">Success</text><polygon fill="#181818" points="330.5,815.2891,320.5,819.2891,330.5,823.2891,326.5,819.2891" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="324.5" x2="658.5" y1="819.2891" y2="819.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="336.5" y="814.2231">Success</text><polygon fill="#181818" points="647.5,844.4219,657.5,848.4219,647.5,852.4219,651.5,848.4219" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="319.5" x2="653.5" y1="848.4219" y2="848.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99" x="326.5" y="843.356">CommitAsync()</text><polygon fill="#181818" points="806.5,873.5547,816.5,877.5547,806.5,881.5547,810.5,877.5547" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="669.5" x2="812.5" y1="877.5547" y2="877.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="676.5" y="872.4888">Commit Transaction</text><polygon fill="#181818" points="680.5,902.6875,670.5,906.6875,680.5,910.6875,676.5,906.6875" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="674.5" x2="822.5" y1="906.6875" y2="906.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="686.5" y="901.6216">Committed</text><polygon fill="#181818" points="330.5,931.8203,320.5,935.8203,330.5,939.8203,326.5,935.8203" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="324.5" x2="658.5" y1="935.8203" y2="935.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="336.5" y="930.7544">Success</text><polygon fill="#181818" points="57.5,960.9531,47.5,964.9531,57.5,968.9531,53.5,964.9531" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="51.5" x2="308.5" y1="964.9531" y2="964.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="63.5" y="959.8872">Operation Result</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="869.5" y1="973.9531" y2="973.9531"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="106" x="15" y="984.1636">[Operation fails]</text><polygon fill="#181818" points="806.5,1004.8906,816.5,1008.8906,806.5,1012.8906,810.5,1008.8906" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="669.5" x2="812.5" y1="1008.8906" y2="1008.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="676.5" y="1003.8247">Rollback Transaction</text><polygon fill="#181818" points="680.5,1034.0234,670.5,1038.0234,680.5,1042.0234,676.5,1038.0234" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="674.5" x2="822.5" y1="1038.0234" y2="1038.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="73" x="686.5" y="1032.9575">Rolled Back</text><polygon fill="#181818" points="330.5,1063.1563,320.5,1067.1563,330.5,1071.1563,326.5,1067.1563" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="324.5" x2="658.5" y1="1067.1563" y2="1067.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="42" x="336.5" y="1062.0903">Failure</text><polygon fill="#181818" points="57.5,1092.2891,47.5,1096.2891,57.5,1100.2891,53.5,1096.2891" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="51.5" x2="308.5" y1="1096.2891" y2="1096.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108" x="63.5" y="1091.2231">throws Exception</text><!--MD5=[1c31d3922ca22878dbdfc602e5056308]
@startuml
participant Client
participant UnitOfWork
participant GenericRepository
participant DbContext
database Database

Client -> UnitOfWork: GetRepository<TEntity>()
activate UnitOfWork

alt Repository exists in cache
    UnitOfWork - -> Client: Cached Repository
else Create new repository
    UnitOfWork -> GenericRepository: <<create>>
    activate GenericRepository
    GenericRepository - -> UnitOfWork: new repository instance
    UnitOfWork -> UnitOfWork: Cache repository
    UnitOfWork - -> Client: New Repository
end
deactivate UnitOfWork

Client -> GenericRepository: SingleOrDefaultAsync(predicate)
activate GenericRepository
GenericRepository -> DbContext: Set<TEntity>()
activate DbContext
DbContext -> DbContext: CreateQuery
DbContext -> Database: Execute Query
activate Database
Database - -> DbContext: Raw Data
deactivate Database
DbContext -> DbContext: Map to Entity
DbContext - -> GenericRepository: Entity
deactivate DbContext
GenericRepository - -> Client: Entity
deactivate GenericRepository

Client -> UnitOfWork: ProcessInTransactionAsync(operation)
activate UnitOfWork
UnitOfWork -> DbContext: BeginTransactionAsync()
activate DbContext

alt Operation succeeds
    DbContext -> Database: Begin Transaction
    activate Database
    Client -> GenericRepository: UpdateAsync(entity)
    activate GenericRepository
    GenericRepository -> DbContext: Update Entity State
    DbContext -> Database: Execute Update
    Database - -> DbContext: Success
    deactivate Database
    DbContext - -> UnitOfWork: Success
    UnitOfWork -> DbContext: CommitAsync()
    DbContext -> Database: Commit Transaction
    activate Database
    Database - -> DbContext: Committed
    deactivate Database
    DbContext - -> UnitOfWork: Success
    UnitOfWork - -> Client: Operation Result
else Operation fails
    DbContext -> Database: Rollback Transaction
    activate Database
    Database - -> DbContext: Rolled Back
    deactivate Database
    DbContext - -> UnitOfWork: Failure
    UnitOfWork - -> Client: throws Exception
end

deactivate GenericRepository
deactivate DbContext
deactivate UnitOfWork
@enduml

PlantUML version 1.2022.7(Mon Aug 22 17:01:30 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>