<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="779px" preserveAspectRatio="none" style="width:1169px;height:779px;background:#FFFFFF;" version="1.1" viewBox="0 0 1169 779" width="1169px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="424.3359" style="stroke:#000000;stroke-width:1.5;" width="1152" x="10" y="256.9609"/><rect fill="none" height="278" style="stroke:#000000;stroke-width:1.5;" width="1132" x="20" y="323.2266"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="49" x2="49" y1="81.2969" y2="698.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="283.5" x2="283.5" y1="81.2969" y2="698.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="675" x2="675" y1="81.2969" y2="698.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1037" x2="1037" y1="81.2969" y2="698.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1106" x2="1106" y1="81.2969" y2="698.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="32" x="30" y="77.9951">User</text><ellipse cx="49" cy="13.5" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M49,21.5 L49,48.5 M36,29.5 L62,29.5 M49,48.5 L36,63.5 M49,48.5 L62,63.5 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="32" x="30" y="710.292">User</text><ellipse cx="49" cy="722.0938" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M49,730.0938 L49,757.0938 M36,738.0938 L62,738.0938 M49,757.0938 L36,772.0938 M49,757.0938 L62,772.0938 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="99" x="231.5" y="77.9951">AuthController</text><path d="M263.5,37 L263.5,61 M263.5,49 L280.5,49 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><ellipse cx="292.5" cy="49" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="99" x="231.5" y="710.292">AuthController</text><path d="M263.5,717.5938 L263.5,741.5938 M263.5,729.5938 L280.5,729.5938 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><ellipse cx="292.5" cy="729.5938" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82" x="631" y="77.9951">AuthService</text><ellipse cx="675" cy="49" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><polygon fill="#181818" points="671,37,677,32,675,37,677,42,671,37" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82" x="631" y="710.292">AuthService</text><ellipse cx="675" cy="729.5938" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><polygon fill="#181818" points="671,717.5938,677,712.5938,675,717.5938,677,722.5938,671,717.5938" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="1014" y="77.9951">JwtUtil</text><ellipse cx="1037" cy="49" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><line style="stroke:#181818;stroke-width:0.5;" x1="1025" x2="1049" y1="63" y2="63"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="1014" y="710.292">JwtUtil</text><ellipse cx="1037" cy="729.5938" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><line style="stroke:#181818;stroke-width:0.5;" x1="1025" x2="1049" y1="743.5938" y2="743.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="1070" y="77.9951">Database</text><path d="M1088,29 C1088,19 1106,19 1106,19 C1106,19 1124,19 1124,29 L1124,55 C1124,65 1106,65 1106,65 C1106,65 1088,65 1088,55 L1088,29 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M1088,29 C1088,39 1106,39 1106,39 C1106,39 1124,39 1124,29 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="1070" y="710.292">Database</text><path d="M1088,723.5938 C1088,713.5938 1106,713.5938 1106,713.5938 C1106,713.5938 1124,713.5938 1124,723.5938 L1124,749.5938 C1124,759.5938 1106,759.5938 1106,759.5938 C1106,759.5938 1088,759.5938 1088,749.5938 L1088,723.5938 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M1088,723.5938 C1088,733.5938 1106,733.5938 1106,733.5938 C1106,733.5938 1124,733.5938 1124,723.5938 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><polygon fill="#181818" points="272,108.4297,282,112.4297,272,116.4297,276,112.4297" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="49" x2="278" y1="112.4297" y2="112.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="56" y="107.3638">POST /login</text><polygon fill="#181818" points="663,137.5625,673,141.5625,663,145.5625,667,141.5625" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="284" x2="669" y1="141.5625" y2="141.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="291" y="136.4966">Login(LoginRequest)</text><polygon fill="#181818" points="1094,166.6953,1104,170.6953,1094,174.6953,1098,170.6953" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="675" x2="1100" y1="170.6953" y2="170.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="682" y="165.6294">GetUserByEmail(Email)</text><polygon fill="#181818" points="686,195.8281,676,199.8281,686,203.8281,682,199.8281" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="680" x2="1105" y1="199.8281" y2="199.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="76" x="692" y="194.7622">Return User</text><line style="stroke:#181818;stroke-width:1.0;" x1="675" x2="717" y1="228.9609" y2="228.9609"/><line style="stroke:#181818;stroke-width:1.0;" x1="717" x2="717" y1="228.9609" y2="241.9609"/><line style="stroke:#181818;stroke-width:1.0;" x1="676" x2="717" y1="241.9609" y2="241.9609"/><polygon fill="#181818" points="686,237.9609,676,241.9609,686,245.9609,682,241.9609" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="682" y="223.895">ValidatePassword(User, Password)</text><path d="M10,256.9609 L74,256.9609 L74,264.0938 L64,274.0938 L10,274.0938 L10,256.9609 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="424.3359" style="stroke:#000000;stroke-width:1.5;" width="1152" x="10" y="256.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="25" y="270.0278">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="108" x="89" y="269.1714">[Password Valid]</text><line style="stroke:#181818;stroke-width:1.0;" x1="675" x2="717" y1="295.2266" y2="295.2266"/><line style="stroke:#181818;stroke-width:1.0;" x1="717" x2="717" y1="295.2266" y2="308.2266"/><line style="stroke:#181818;stroke-width:1.0;" x1="676" x2="717" y1="308.2266" y2="308.2266"/><polygon fill="#181818" points="686,304.2266,676,308.2266,686,312.2266,682,308.2266" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177" x="682" y="290.1606">CheckPasswordExpiry(User)</text><path d="M20,323.2266 L84,323.2266 L84,330.3594 L74,340.3594 L20,340.3594 L20,323.2266 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="278" style="stroke:#000000;stroke-width:1.5;" width="1132" x="20" y="323.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="35" y="336.2935">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="124" x="99" y="335.437">[Password Expired]</text><polygon fill="#181818" points="1025,357.4922,1035,361.4922,1025,365.4922,1029,361.4922" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="675" x2="1031" y1="361.4922" y2="361.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334" x="682" y="356.4263">GenerateJwtToken(User, isResetPasswordOnly=true)</text><polygon fill="#181818" points="295,386.625,285,390.625,295,394.625,291,390.625" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="289" x2="674" y1="390.625" y2="390.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210" x="301" y="385.5591">Throw PasswordExpiredException</text><polygon fill="#181818" points="60,415.7578,50,419.7578,60,423.7578,56,419.7578" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="54" x2="283" y1="419.7578" y2="419.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208" x="66" y="414.6919">Return Error("Password expired")</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="20" x2="1152" y1="428.7578" y2="428.7578"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="150" x="25" y="438.9683">[Password Not Expired]</text><polygon fill="#181818" points="1025,459.6953,1035,463.6953,1025,467.6953,1029,463.6953" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="675" x2="1031" y1="463.6953" y2="463.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="338" x="682" y="458.6294">GenerateJwtToken(User, isResetPasswordOnly=false)</text><line style="stroke:#181818;stroke-width:1.0;" x1="675" x2="717" y1="492.8281" y2="492.8281"/><line style="stroke:#181818;stroke-width:1.0;" x1="717" x2="717" y1="492.8281" y2="505.8281"/><line style="stroke:#181818;stroke-width:1.0;" x1="676" x2="717" y1="505.8281" y2="505.8281"/><polygon fill="#181818" points="686,501.8281,676,505.8281,686,509.8281,682,505.8281" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="682" y="487.7622">GenerateRefreshToken(User)</text><polygon fill="#181818" points="1094,530.9609,1104,534.9609,1094,538.9609,1098,534.9609" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="675" x2="1100" y1="534.9609" y2="534.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="252" x="682" y="529.895">SaveRefreshToken(User, RefreshToken)</text><polygon fill="#181818" points="295,560.0938,285,564.0938,295,568.0938,291,564.0938" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="289" x2="674" y1="564.0938" y2="564.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="367" x="301" y="559.0278">Return LoginResponse(AccessToken, RefreshToken, User)</text><polygon fill="#181818" points="60,589.2266,50,593.2266,60,597.2266,56,593.2266" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="54" x2="283" y1="593.2266" y2="593.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="66" y="588.1606">Return LoginResponse</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="1162" y1="609.2266" y2="609.2266"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="119" x="15" y="619.437">[Password Invalid]</text><polygon fill="#181818" points="295,640.1641,285,644.1641,295,648.1641,291,644.1641" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="289" x2="674" y1="644.1641" y2="644.1641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211" x="301" y="639.0981">Return Error("Invalid credentials")</text><polygon fill="#181818" points="60,669.2969,50,673.2969,60,677.2969,56,673.2969" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="54" x2="283" y1="673.2969" y2="673.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211" x="66" y="668.231">Return Error("Invalid credentials")</text><!--MD5=[ceb34875d3b76420afc940565f999fff]
@startuml
actor User
boundary AuthController
control AuthService
entity JwtUtil
database Database

User -> AuthController: POST /login
AuthController -> AuthService: Login(LoginRequest)
AuthService -> Database: GetUserByEmail(Email)
Database -> AuthService: Return User
AuthService -> AuthService: ValidatePassword(User, Password)
alt Password Valid
    AuthService -> AuthService: CheckPasswordExpiry(User)
    alt Password Expired
        AuthService -> JwtUtil: GenerateJwtToken(User, isResetPasswordOnly=true)
        AuthService -> AuthController: Throw PasswordExpiredException
        AuthController -> User: Return Error("Password expired")
    else Password Not Expired
        AuthService -> JwtUtil: GenerateJwtToken(User, isResetPasswordOnly=false)
        AuthService -> AuthService: GenerateRefreshToken(User)
        AuthService -> Database: SaveRefreshToken(User, RefreshToken)
        AuthService -> AuthController: Return LoginResponse(AccessToken, RefreshToken, User)
        AuthController -> User: Return LoginResponse
    end
else Password Invalid
    AuthService -> AuthController: Return Error("Invalid credentials")
    AuthController -> User: Return Error("Invalid credentials")
end
@enduml

PlantUML version 1.2022.7(Mon Aug 22 17:01:30 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>